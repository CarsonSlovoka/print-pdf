<title>print-pdf</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">

<body>
<main class="container">
  <h1>Print-pdf</h1>
  <form id="main">
    <label>filename<input name="filename" type="text" required></label>
    <label>URL<input id="url" type="text" placeholder="http://127.0.0.1:8080/test.md?print-pdf" title="https://..." required></label>
    <!-- TODO: waitVisible 也許可以考慮設定成多個 -->
    <label>WaitVisible<input name="waitVisible" type="text" placeholder="body"></label>
    <input type="submit">
  </form>
  <pre></pre>
</main>
</body>

<script>
  const form = document.forms["main"]
  form.onsubmit = async (e) => {
    e.preventDefault()
    const formData = new FormData()
    formData.set("url", form.url.value)
    formData.set("filename", form.filename.value)
    formData.set("waitVisible", form.waitVisible.value)

    const resp = await fetch("/download", {
      method: "post",
      body: formData,
    })
    if (!resp.ok) {
      alert(`${resp.statusText} (${resp.status}) | ${await resp.text()} `)
    } else {
      document.querySelector("pre").innerHTML = JSON.stringify(await resp.json(), null, 2)
    }
    return false
  }
</script>
